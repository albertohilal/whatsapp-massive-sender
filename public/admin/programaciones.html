<!DOCTYPE html>
  <script src="/admin/admin_programaciones.js" defer></script>
    async function cargarProgramaciones() {
      try {
        const pendientesRes = await fetch('/admin/programaciones?estado=pendiente');
        const pendientes = await pendientesRes.json();
        renderLista('programaciones-pendientes', pendientes, true);

        const activasRes = await fetch('/admin/programaciones?estado=aprobada');
        const activas = await activasRes.json();
        renderLista('programaciones-activas', activas);
      } catch (err) {
        console.error('Error cargando programaciones:', err);
      }
    }

    async function ejecutarAccion(id, accion) {
      let endpoint = accion;
      if (accion === 'aprobar') endpoint = 'aprobar';
      if (accion === 'rechazar') endpoint = 'rechazar';
      if (accion === 'pausar') endpoint = 'pausar';
      if (accion === 'reanudar') endpoint = 'reanudar';
      try {
        const res = await fetch(`/admin/programaciones/${id}/${endpoint}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({})
        });
        if (!res.ok) throw new Error('Error ejecutando acción');
        await cargarProgramaciones();
      } catch {
        alert('No se pudo completar la acción.');
      }
    }

    document.addEventListener('click', (e) => {
      const accion = e.target.dataset.accion;
      if (!accion) return;
      const card = e.target.closest('.accion-buttons');
      if (!card) return;
      const id = card.dataset.id;
      ejecutarAccion(id, accion);
    });

    document.addEventListener('DOMContentLoaded', async () => {
      await mostrarUsuario();
      await cargarProgramaciones();
    });
  </script>
  <script src="/dashboard_link.js"></script>
</body>
</html>
