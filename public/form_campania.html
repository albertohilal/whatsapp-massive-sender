<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/favicon.ico">
  <title>Campaña de WhatsApp</title>
</head>
<body>
  <h2>Campaña de WhatsApp</h2>

  <label for="campanas">Campañas existentes:</label>
  <select id="campanas">
    <option value="">-- Seleccionar una campaña --</option>
  </select>

  <br /><br />

  <label for="nombre">Nombre nueva campaña:</label>
  <input type="text" id="nombre" />

  <br /><br />

  <label for="mensaje">Mensaje:</label><br />
  <textarea id="mensaje" rows="5" cols="60"></textarea>

  <br /><br />
  <button onclick="guardarCampania()">Guardar campaña</button>

  <script>
    async function cargarCampanias() {
      try {
        const response = await fetch('/api/campanias');
        const campanias = await response.json();
        const select = document.getElementById('campanas');
        select.innerHTML = '<option value="">-- Seleccionar una campaña --</option>';

        if (Array.isArray(campanias)) {
          campanias.forEach(campania => {
            const option = document.createElement('option');
            option.value = campania.id;
            option.textContent = campania.nombre;
            select.appendChild(option);
          });
        } else {
          console.error('Respuesta inesperada:', campanias);
        }
      } catch (error) {
        console.error('Error al cargar campañas:', error);
      }
    }

    async function guardarCampania() {
      const nombre = document.getElementById('nombre').value;
      const mensaje = document.getElementById('mensaje').value;

      try {
        const response = await fetch('/api/campanias', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nombre, mensaje })
        });

        const resultado = await response.json();
        alert(resultado.message || 'Campaña guardada');
        cargarCampanias(); // Refresca la lista
      } catch (error) {
        console.error('Error al guardar campaña:', error);
      }
    }

    cargarCampanias();
  </script>
</body>
</html>
