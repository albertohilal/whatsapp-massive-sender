<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Habysupply - WhatsApp Massive Sender</title>
  <link rel="stylesheet" href="/habysupply/style.css">
</head>
<body>
  <h1>Habysupply</h1>
  <div id="usuario-logueado" class="usuario-header" style="margin-bottom:12px;"></div>
  <p class="subtitle">Sigue estos pasos para dejar tus campañas listas y permitir que el administrador realice los envíos.</p>

  <section class="card" style="margin-bottom:24px;">
    <script src="/habysupply/habysupply_dashboard.js" defer></script>
      this.disabled = true;
      try {
        const res = await fetch('/habysupply/api/wapp-session/init', { method: 'POST' });
        const data = await res.json();
        alert(data.message || (data.success ? 'Sesión iniciándose...' : 'No se pudo iniciar'));
      } catch (err) {
        console.error('Error al iniciar sesión:', err);
        alert('Error iniciando sesión.');
      }
      this.disabled = false;
      cargarEstadoSesion();
    });

    document.getElementById('wapp-session-close').addEventListener('click', async function() {
      this.disabled = true;
      try {
        const res = await fetch('/habysupply/api/wapp-session/close', { method: 'POST' });
        const data = await res.json();
        alert(data.message || (data.success ? 'Sesión cerrada.' : 'No se pudo cerrar'));
      } catch (err) {
        console.error('Error al cerrar sesión:', err);
        alert('Error cerrando sesión.');
      }
      this.disabled = false;
      cargarEstadoSesion();
    });

    window.addEventListener('DOMContentLoaded', () => {
      cargarCampanias();
      cargarEstadoSesion();
    });
  </script>

  <script src="/dashboard_link.js"></script>
</body>
</html>
