<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Campa単as Marketing</title>
  <link rel="stylesheet" href="/habysupply/style.css">
</head>
<body>
  <h1>Campa単as - Marketing</h1>
  <div id="usuario-logueado" class="usuario-header" style="margin-bottom:12px;"></div>
  <div id="campanias-list"></div>
  <script>
    const params = new URLSearchParams(window.location.search);
    const modoAdmin = params.get('modo') === 'admin';
    const clienteIdOverride = params.get('cliente_id') || params.get('cliente');

    async function mostrarUsuario() {
      try {
        const res = await fetch('/api/usuario-logueado');
        const data = await res.json();
        if (data && data.usuario) {
          document.getElementById('usuario-logueado').textContent = `Usuario: ${data.usuario}`;
        }
      } catch (err) {
        document.getElementById('usuario-logueado').textContent = '';
      }
    }
    mostrarUsuario();

    async function cargarCampanias() {
      try {
        let url = '/marketing/campanias';
        if (modoAdmin && clienteIdOverride) {
          url += `?cliente_id=${clienteIdOverride}`;
        }
        const res = await fetch(url);
        const campanias = await res.json();
        const cont = document.getElementById('campanias-list');
        if (!Array.isArray(campanias) || campanias.length === 0) {
          cont.innerHTML = '<p>No hay campa単as registradas.</p>';
        } else {
          cont.innerHTML = campanias.map(c => `<div><strong>${c.nombre}</strong> - Estado: ${c.estado}</div>`).join('');
        }
      } catch (err) {
        document.getElementById('campanias-list').innerHTML = '<p>Error al cargar campa単as.</p>';
      }
    }
    cargarCampanias();
  </script>

  <script src="/dashboard_link.js"></script>
</body>
</html>
